(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[695],{3937:function(e,t,n){"use strict";n.d(t,"e",function(){return o});var a=n(891),i=n(155),r=n(15);function o(e,t,n){return!(e.type===i.t.OneNote||e.list||e.subsite||(n||!e.urls[a.e.downloadAsZip]||!e.urls[a.e.itemUrl]||0===e.childCount||e.type!==i.t.Folder)&&(e.isRootFolder||!t||t&&t.list&&t.list.templateType===r.n.webPageLibrary||e.type!==i.t.File&&e.type!==i.t.Media&&e.type!==i.t.Unknown))}},5259:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return L});var a=n(0),i=n(3937),r=n(1426),o=n(116),s=n(15),c=n(269),d=n(125),l=n(47),u=n(124),f=n(51),p=n(478),m=n(2290),_=n(2584),h=n(380),b=n(1291),g=n(156),v=n(13),y=n(1030),S=n(97),D=n(1430),I=n(285),x=n(1482),C=n(70),O=n(672),w=n(35),E=n(1049),A=function(){function e(e,t){this.hmacAlreadyRequested=!1,this._urlDataSource=t.urlDataSource,this._itemUrlHelper=t.itemUrlHelper,this._itemParentHelper=t.itemParentHelper,this._pageContext=t.pageContext,this._urlCache=new Map,this._vroomDataRequestor=t.vroomDataRequestor,this._identityDataSource=t.identityDataSource,this._isOneDriveWinApp=Object(g.e)(),this._tokenFetcher=t.tokenFetcher}return e.prototype.getHmacHash=function(e,t){var n,a,i=this;if(this.hmacAlreadyRequested)return this.hmacPromise;this.hmacPromise=new o.n(function(e,t){n=e,a=t});var r="".concat(t.url,"?&access_token=").concat(t.access_token,"&provider=").concat(t.provider,"&docId=").concat(t.docId,"&apiUrlPath=").concat(t.apiUrlPath);return this.hmacAlreadyRequested=!0,y.e.start({url:r}).then(function(t){i.hmacAlreadyRequested=!1;var a=i.mapHmacParams(JSON.parse(t.response||{}));e.hmac={expiry:a.expiry,symmetricKey:a.symmetricKey,algoId:a.algoId,digest:a.digest},n(a)}).catch(function(e){i.hmacAlreadyRequested=!1,S.e.logError(e),a(e)}),this.hmacPromise},e.prototype.getDownloadUrl=function(e,t){var n=this;void 0===t&&(t={});var i=this._urlCache;if(!t.forceRefresh){var r=i.get(e.key)||{},s=r.url,c=r.time;if(s&&c<Date.now()-27e5)return o.n.wrap(s)}var d,u=this.getItemUrl(e,t),f=this._itemUrlHelper.getItemUrlParts(e.key),p=f.isCrossDomain;if((this._isOneDriveWinApp||!v.e.isActivated("0f0d3a2a-33cd-4a8f-8892-42b79c97c964","08/23/2021","Fix Gallatin download token issue for shared file")&&Object(O.r)())&&(p||f.isCrossList))d=this._identityDataSource.getSharePointToken(new l.e(u).authority);else{var m=(t||{}).apiVersion,_=void 0===m?Object(w.isFeatureEnabled)(w.MediaTAUseVroomV21)?"v2.1":"v2.0":m;d=Object(w.isFeatureEnabled)(w.VideoTokenFromGraph)&&!Object(O.r)()?this.refreshAccessToken(e,Object(a.__assign)(Object(a.__assign)({},t),{apiVersion:_})).then(function(){return n.getAccessToken(e,t)}):o.n.resolve(this.getAccessToken(e))}var h="itemDownloadUrl";t.apiName&&(h="".concat(t.apiName,".").concat(h));var b=!p;return d.then(function(e){return n._vroomDataRequestor.send({apiName:h,path:"".concat(u,"?select=id,@content.downloadUrl"),accessToken:b?void 0:e,qosExtraData:t.qosExtraData,allowCookies:b})}).then(function(t){var n=t["@content.downloadUrl"].replace(/[?&]ApiVersion=[^&]+/,"");return i.set(e.key,{url:n,time:Date.now()}),n})},e.prototype.getDownloadUrlSync=function(e,t){void 0===t&&(t={});var n=Object(r.a)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"list"));if(i.e(Object(_.n)(e),Object(_.n)(n),!1)){var a=this.getItemUrl(e,t),o=this._getAuthenticationParamsSync(e,t),s=Object(c.e)(o);return a&&"".concat(a,"/content?").concat(s)}},e.prototype.getAuthenticationParams=function(e,t){var n=this,i=(t||{}).apiVersion,r=void 0===i?Object(w.isFeatureEnabled)(w.MediaTAUseVroomV21)?"v2.1":"v2.0":i;return Object(w.isFeatureEnabled)(w.VideoTokenFromGraph)&&!Object(O.r)()?this.refreshAccessToken(e,Object(a.__assign)(Object(a.__assign)({},t),{apiVersion:r})).then(function(){return n._getAuthenticationParamsSync(e,t)}):o.n.resolve(this._getAuthenticationParamsSync(e,t))},e.prototype.getDriveUrl=function(e,t){void 0===t&&(t={});var n=t.useDirectEndpoint,a=void 0===n?!this._pageContext.isSPO:n,i=t.apiVersion,r=void 0===i?"v2.0":i,o=t.allowCookies,s=this._getGraphBaseUrl(e,{useDirectEndpoint:a,apiVersion:r,allowCookies:o}),c=e.graph;if(c)return"".concat(s,"/drives/").concat(encodeURIComponent(c.driveId));var d=this._getDriveUrl(e,s);if(!d)throw new Error("Unable to determine graph identity for item");return d},e.prototype.getItemUrl=function(e,t){var n,a;void 0===t&&(t={});var i=t.useDirectEndpoint,o=void 0===i?!this._pageContext.isSPO:i,c=t.isPath,d=void 0!==c&&c,l=t.apiVersion,u=void 0===l?"v2.0":l,f=t.allowCookies,p=void 0!==f&&f,m=this._getGraphBaseUrl(e,{useDirectEndpoint:o,apiVersion:u,allowCookies:p}),_=e.graph,h=e.remoteItem,b=Object(r.a)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"list")),g=(null===(n=null==b?void 0:b.list)||void 0===n?void 0:n.templateType)===s.n.genericList;if(h){var y=h.DriveId,S=void 0===y?"me":y,D=h.ItemId,I=void 0===D?"root":D;return"".concat(m,"/drives/").concat(encodeURIComponent(S)).concat("root"===I?"/root":"/items/".concat(encodeURIComponent(I))).concat(d?":":"")}if(_&&_.driveId&&"root"!==_.itemId&&!g){var x=_.driveId,C=(S=void 0===x?"me":x,_.itemId);return I=void 0===C?"root":C,"".concat(m,"/drives/").concat(encodeURIComponent(S)).concat("root"===I?"/root":"/items/".concat(encodeURIComponent(I))).concat(d?":":"")}var O=g&&!v.e.isActivated("8ED612A4-8843-462D-859B-E86CDCD37E4E","6/02/2021","Fix graph url for custom lists")?this._getListUrl(b,m):this._getDriveUrl(e,m);if(O){if(g)return e===b?O:"".concat(O,"/items/").concat(null===(a=e.properties)||void 0===a?void 0:a.ID);var w=b.list.listUrlDir,E=this._itemUrlHelper.getItemUrlParts(e.key),A=(w?this._itemUrlHelper.getUrlParts({path:E.serverRelativeItemUrl,listUrl:w}):E).listRelativeItemUrl;return"".concat(O,"/root").concat(A?":/".concat(encodeURI(A)).concat(d?"":":"):"".concat(d?":":""))}},e.prototype.getAccessToken=function(e,t){if(void 0===t&&(t={}),!this._pageContext.isSPO||e.remoteItem)return{};var n=t.apiVersion,a=Object(r.a)(this._itemParentHelper.getAncestorOrSelf(e,function(e){var t=e.graph;return!!t&&!!t.sessionToken}));return"v2.1"===n?a&&a.graph.sessionTokenV21:a&&a.graph.sessionToken},e.prototype.refreshAccessToken=function(e,t){var n=this;void 0===t&&(t={});var a=t.apiVersion,i=t.forceRefresh,r=void 0!==i&&i;if(Object(w.isFeatureEnabled)(w.VideoTokenFromGraph)&&a&&!Object(O.r)()){var s=this.getAccessToken(e,{apiVersion:a});if(s){var c=s.accessToken,d=s.proofToken,u=s.tokenExpiry,f=Object(w.isFeatureEnabled)(w.VideoMoreAgressiveTokenRefresh)?3e5:6e4;if(!r&&!Object(x.e)(Object(D.default)({authToken:c},{proofToken:D.optional(d),expiry:D.optional(u?new Date(u):void 0)}),f))return o.n.resolve(s)}return this._tokenFetcher.getAuthToken(e.key).then(function(e){var t=e.data,i=t[".driveAccessToken"],r=t[".driveAccessTokenV21"],s=t[".driveUrl"],c=t[".driveUrlV21"];return s&&i&&"v2.0"===a?o.n.resolve({accessToken:n._extractToken(i),tokenUrl:s}):c&&r&&"v2.1"===a?o.n.resolve({accessToken:n._extractToken(r),tokenUrl:c}):o.n.reject(new C.e({code:"NoAuth",isExpected:!1,message:"Cannot find drive access token"}))})}var p=this._itemUrlHelper.getItemUrlParts(e.key).fullItemUrl;return this._identityDataSource.getSharePointToken(new l.e(p).authority)},e.prototype._extractToken=function(e){if(e.indexOf("=")<0)return e;var t=Object(I.e)(e);return t&&t.access_token},e.prototype._getAuthenticationParamsSync=function(e,t){var n=this.getAccessToken(e,t);if(n){var a=n.accessToken,i=n.proofToken,r={};return a&&(r.access_token=a),i&&(r.prooftoken=i),r}return{}},e.prototype._getGraphBaseUrl=function(e,t){var n=t.useDirectEndpoint,a=t.apiVersion,i=t.allowCookies,o=Object(r.a)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"list")),s=this._itemUrlHelper.getItemUrlParts(e.key);if(n){if(o){var c=this._itemUrlHelper.getItemUrlParts(o.key).fullItemUrl;if(i&&!s.isCrossDomain){var d=Object(r.a)(this._itemParentHelper.getFacetedAncestorOrSelf(o,"subsite"));if(d&&d.subsite){var u;return u=d&&d.subsite.serverRelativeUrl!==this._pageContext.webAbsoluteUrl?d.subsite.serverRelativeUrl:this._pageContext.webAbsoluteUrl,"".concat(u,"/_api/").concat(a)}}return"".concat(new l.e(c).authority,"/_api/").concat(a)}return s.isCrossDomain||s.isCrossList?(c=this._itemUrlHelper.getItemUrlParts(e.key).fullItemUrl,"".concat(new l.e(c).authority,"/_api/").concat(a)):this._urlDataSource.getApiBaseUrl({apiVersion:a})}return"https://graph.microsoft.com/v1.0"},e.prototype.mapHmacParams=function(e){return void 0===e&&(e={}),{expiry:e.p1||"",symmetricKey:e.p2||"",algoId:e.p3||"",digest:e.p4||""}},e.prototype._getDriveUrl=function(e,t){var n=Object(r.a)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"list"));if(n){var a=n.graph,i=a&&a.driveId;return i?"".concat(t,"/drives/").concat(encodeURIComponent(i)):this._getListUrl(n,t)}},e.prototype._getListUrl=function(e,t){var n;if(e){var a=Object(r.a)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"subsite")),i=void 0,o=void 0,c=void 0;if(a&&a.subsite.serverRelativeUrl!==this._pageContext.webAbsoluteUrl){var d=a.subsite;i=d.siteCollectionId,o=d.id,c=d.serverRelativeUrl}else{var u=this._pageContext;i=u.siteId,o=u.webId,c=u.webAbsoluteUrl}var f=new l.e(c).domain,p=e.list.id||e.displayName;if(!p)return;return(null===(n=e.list)||void 0===n?void 0:n.templateType)===s.n.genericList?"".concat(t,"/sites/").concat(f,",").concat(i,",").concat(o,"/lists/").concat(p).replace(/[{}]/g,""):t.slice(0,this._pageContext.webAbsoluteUrl.length)===this._pageContext.webAbsoluteUrl?"".concat(t,"/sites/root/lists/").concat(p,"/drive"):"".concat(t,"/sites/").concat(f,",").concat(i,",").concat(o,"/lists/").concat(p,"/drive").replace(/[{}]/g,"")}},e.dependencies={urlDataSource:u.he,itemUrlHelper:p.s,itemParentHelper:m.e,pageContext:f.p,vroomDataRequestor:b.e,identityDataSource:h.resourceKey,tokenFetcher:E.e},e}();t.default=A;var L=Object(d.r)("GraphDataSource",A)}}]);